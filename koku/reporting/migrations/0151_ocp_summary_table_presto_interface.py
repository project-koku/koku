# Generated by Django 3.1.2 on 2020-11-09 22:06
from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [("reporting", "0150_presto_bulk_pk_delete")]

    operations = [
        migrations.RunSQL(
            """
create view reporting_ocpusagelineitem_daily_summary_presto as
select cluster_id,
       cluster_alias,
       data_source,
       namespace,
       node,
       resource_id,
       usage_start,
       usage_end,
       pod_labels::json,
       pod_usage_cpu_core_hours::text,
       pod_request_cpu_core_hours::text,
       pod_limit_cpu_core_hours::text,
       pod_usage_memory_gigabyte_hours::text,
       pod_request_memory_gigabyte_hours::text,
       pod_limit_memory_gigabyte_hours::text,
       node_capacity_cpu_cores::text,
       node_capacity_cpu_core_hours::text,
       node_capacity_memory_gigabytes::text,
       node_capacity_memory_gigabyte_hours::text,
       cluster_capacity_cpu_core_hours::text,
       cluster_capacity_memory_gigabyte_hours::text,
       persistentvolumeclaim,
       persistentvolume,
       storageclass,
       volume_labels::json,
       persistentvolumeclaim_capacity_gigabyte::text,
       persistentvolumeclaim_capacity_gigabyte_months::text,
       volume_request_storage_gigabyte_months::text,
       persistentvolumeclaim_usage_gigabyte_months::text,
       infrastructure_raw_cost::text,
       infrastructure_project_raw_cost::text,
       infrastructure_usage_cost::json,
       infrastructure_markup_cost::text,
       infrastructure_project_markup_cost::text,
       infrastructure_monthly_cost::text,
       supplementary_usage_cost::json,
       supplementary_monthly_cost::text,
       monthly_cost_type,
       source_uuid,
       report_period_id,
       uuid
from reporting_ocpusagelineitem_daily_summary;
"""
        ),
        migrations.RunSQL(
            """
create rule ins_reporting_ocpusagelineitem_daily_summary_presto as
    on insert to reporting_ocpusagelineitem_daily_summary_presto
    do instead
       insert into reporting_ocpusagelineitem_daily_summary (
           cluster_id,
           cluster_alias,
           data_source,
           namespace,
           node,
           resource_id,
           usage_start,
           usage_end,
           pod_labels,
           pod_usage_cpu_core_hours,
           pod_request_cpu_core_hours,
           pod_limit_cpu_core_hours,
           pod_usage_memory_gigabyte_hours,
           pod_request_memory_gigabyte_hours,
           pod_limit_memory_gigabyte_hours,
           node_capacity_cpu_cores,
           node_capacity_cpu_core_hours,
           node_capacity_memory_gigabytes,
           node_capacity_memory_gigabyte_hours,
           cluster_capacity_cpu_core_hours,
           cluster_capacity_memory_gigabyte_hours,
           persistentvolumeclaim,
           persistentvolume,
           storageclass,
           volume_labels,
           persistentvolumeclaim_capacity_gigabyte,
           persistentvolumeclaim_capacity_gigabyte_months,
           volume_request_storage_gigabyte_months,
           persistentvolumeclaim_usage_gigabyte_months,
           infrastructure_raw_cost,
           infrastructure_project_raw_cost,
           infrastructure_usage_cost,
           infrastructure_markup_cost,
           infrastructure_project_markup_cost,
           infrastructure_monthly_cost,
           supplementary_usage_cost,
           supplementary_monthly_cost,
           monthly_cost_type,
           source_uuid,
           report_period_id,
           uuid
       )
       values (
           NEW.cluster_id,
           NEW.cluster_alias,
           NEW.data_source,
           NEW.namespace,
           NEW.node,
           NEW.resource_id,
           NEW.usage_start,
           NEW.usage_end,
           NEW.pod_labels::jsonb,
           NEW.pod_usage_cpu_core_hours::numeric(73,9),
           NEW.pod_request_cpu_core_hours::numeric(73,9),
           NEW.pod_limit_cpu_core_hours::numeric(73,9),
           NEW.pod_usage_memory_gigabyte_hours::numeric(73,9),
           NEW.pod_request_memory_gigabyte_hours::numeric(73,9),
           NEW.pod_limit_memory_gigabyte_hours::numeric(73,9),
           NEW.node_capacity_cpu_cores::numeric(73,9),
           NEW.node_capacity_cpu_core_hours::numeric(73,9),
           NEW.node_capacity_memory_gigabytes::numeric(73,9),
           NEW.node_capacity_memory_gigabyte_hours::numeric(73,9),
           NEW.cluster_capacity_cpu_core_hours::numeric(73,9),
           NEW.cluster_capacity_memory_gigabyte_hours::numeric(73,9),
           NEW.persistentvolumeclaim,
           NEW.persistentvolume,
           NEW.storageclass,
           NEW.volume_labels::jsonb,
           NEW.persistentvolumeclaim_capacity_gigabyte::numeric(73,9),
           NEW.persistentvolumeclaim_capacity_gigabyte_months::numeric(73,9),
           NEW.volume_request_storage_gigabyte_months::numeric(73,9),
           NEW.persistentvolumeclaim_usage_gigabyte_months::numeric(73,9),
           NEW.infrastructure_raw_cost::numeric(33,15),
           NEW.infrastructure_project_raw_cost::numeric(33,15),
           NEW.infrastructure_usage_cost::jsonb,
           NEW.infrastructure_markup_cost::numeric(33,15),
           NEW.infrastructure_project_markup_cost::numeric(33,15),
           NEW.infrastructure_monthly_cost::numeric(33,15),
           NEW.supplementary_usage_cost::jsonb,
           NEW.supplementary_monthly_cost::numeric(33,15),
           NEW.monthly_cost_type,
           NEW.source_uuid,
           NEW.report_period_id,
           NEW.uuid
       );
comment on view reporting_ocpusagelineitem_daily_summary_presto is 'Interface to reporting_ocpusagelineitem_daily_summary table for Presto';
"""
        ),
    ]
