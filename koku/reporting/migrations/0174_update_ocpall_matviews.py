# Generated by Django 3.1.7 on 2021-04-09 18:24
import pkgutil

from django.db import migrations

from reporting.provider.all.openshift.models import VIEWS as OCP_ALL_VIEWS


def add_views(apps, schema_editor):
    """Create database VIEWS from files."""
    connection = schema_editor.connection
    for view in OCP_ALL_VIEWS:
        view_sql = pkgutil.get_data("reporting.provider.all.openshift", f"sql/views/{view}.sql")
        view_sql = view_sql.decode("utf-8")
        with connection.cursor() as cursor:
            cursor.execute(view_sql)


class Migration(migrations.Migration):

    dependencies = [("reporting", "0173_auto_20210325_1354")]

    operations = [
        migrations.RunSQL("""drop materialized view reporting_ocpallcostlineitem_daily_summary cascade;"""),
        migrations.RunPython(add_views),
    ]
