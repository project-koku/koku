name: pre release

on:
  create:
    tags:
    - 'r.*'

jobs:
  pre-release:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Get release notes
      run: echo "::set-output name=RELEASE_BODY::$(git log $(git tag --list | tail -2 | head -1)..$(git tag --list | tail -1) --pretty=format:'* %h - %s')"
      id: release-notes-generator
    - uses: ncipollo/release-action@v1
      with:
        allowUpdates: true
        body: ${{ steps.release-notes-generator.outputs.RELEASE_BODY }}
        prerelease: true
        token: ${{ secrets.GITHUB_TOKEN }}
